mapView=function(){const e=document.getElementById("map");let a,n;const l=e=>{e.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(()=>{e.setAnimation(null)},800)};return{init:function(){return a=new google.maps.Map(e,{center:{lat:37.7749,lng:-122.4194},zoom:12,streetViewControl:!1}),n=new google.maps.InfoWindow,a},createMarkerMap:function(e){const n=new google.maps.Marker({position:e.location,animation:google.maps.Animation.DROP,placeId:e.placeId,label:e.number.toString(),map:a});return n.addListener("click",function(){placesViewModel.showPlaceDetail(this),l(n)}),n},animateMarker:function(e){l(e)},closeInfoWindow:function(){n.close()},openInfoWindowWithPlaceDetails:function(e,l){((e,l)=>{n.open(a,e),n.setContent(l)})(e,(e=>e?`<div class="infoContent text-black" >\n            <div><p><i class="fas fa-heart"></i><strong>Name:</strong>${e.name} </p></div>\n            <div><p><i class="fas fa-map-marker-alt"></i><strong>Address: </strong>${e.address} </p></div>\n            <div><p><i class="fas fa-phone"></i><strong>Phone number: </strong>${e.phoneNumber} </p></li>\n            <div><p><i class="fas fa-thumbs-up"></i><strong>Raiting: </strong>${e.rating} </p></div>\n            <div><p><i class="fas fa-link"></i><strong target="_blank">Url: </strong><a href="${e.url}">Find me here</a></p></li>\n            <div><p><i class="far fa-calendar-alt"></i><strong>Open Now: </strong>${e.openNow}</p></div>\n            </div>`:"<div><h3>an error has occurred</h3></div>")(l))}}}(),places={MY_PLACES:[{name:"Golden Gate Park",placeId:"ChIJY_dFYHKHhYARMKc772iLvnE",location:{lat:37.7694208,lng:-122.4862138}},{name:"Golden Gate Bridge",placeId:"ChIJY5udcZCGhYARw6Vh3xj2V0Y",location:{lat:37.8199882,lng:-122.478322}},{name:"Ghirardelli Square",placeId:"ChIJvXl2weCAhYARjSxnhzrBfNc",location:{lat:37.8058763,lng:-122.4229502}},{name:"Ferry Building",placeId:"ChIJu1XQjGaAhYAR966C7JnAu5w",location:{lat:37.7955703,lng:-122.3933208}},{name:"PIER 39",placeId:"ChIJHSGzi_yAhYARnrPmDWAx9ro",location:{lat:37.808673,lng:-122.409821}},{name:"San Francisco Zoo",placeId:"ChIJjaIC83F9j4AR1z3B225I_XU",location:{lat:37.7331299,lng:-122.5051593}},{name:"Yerba Buena Gardens",placeId:"ChIJCUsDnIeAhYARWCBpPTrHJpQ",location:{lat:37.7850153,lng:-122.3896196}},{name:"San Francisco City Hall",placeId:"ChIJY-bqepmAhYARSk9Xg_9tcLI",location:{lat:37.7792597,lng:-122.4192646}},{name:"Twin Peaks",placeId:"ChIJp71fQgh-j4ARV7YEtWUmni0",location:{lat:37.7544066,lng:-122.4476845}},{name:"Alcatraz Island",placeId:"ChIJmRyMs_mAhYARpViaf6JEWNE",location:{lat:37.8269775,lng:-122.4229555}}]},placesService=function(){const e=document.getElementById("input-new-Place"),a={};let n,l;const o=e=>(a[e]={detail:null,moreInfo:null},a[e]),t=e=>fetch(e).then(e=>200!==e.status?(console.log("Error Status: "+e.status),Promise.reject(null)):e.json()).catch(function(e){return console.log("Error: "+e),Promise.reject(null)});return{init:function(a){n=new google.maps.places.PlacesService(a),(l=new google.maps.places.Autocomplete(e)).bindTo("bounds",a),l.addListener("place_changed",()=>{placesViewModel.createPlace(l.getPlace())})},searchDetail:function(e){return new Promise((l,t)=>{let i=a[e];i||(i=o(e)),i.detail&&l(i.detail),n.getDetails({placeId:e},(e,a)=>{a!==google.maps.places.PlacesServiceStatus.OK&&t(null),i.detail=(e=>({placeId:e.place_id,name:e.name?e.name:"Not available",address:e.formatted_address?e.formatted_address:"Not available",phoneNumber:e.formatted_phone_number?e.formatted_phone_number:"Not available",rating:e.rating?e.rating:"Not available",types:e.types,url:e.url?e.url:"#",openNow:e.opening_hours?e.opening_hours.open_now:"Not available"}))(e),l(i.detail)})})},searchText:function(e){return new Promise((a,l)=>{n.textSearch({query:e},function(e,n){n!==google.maps.places.PlacesServiceStatus.OK&&l(void 0),a(e[0])})})},getMoreInfo:function(e){return new Promise((i,r)=>{let c=a[e.placeId]?a[e.placeId]:o(e.placeId);c.moreInfo&&i(c.moreInfo),c.moreInfo={name:e.name,placeId:e.placeId},t((e=>`https://en.wikipedia.org//w/api.php?action=opensearch&format=json&origin=*&search=${e}&limit=3`)(e.name)).then(e=>{c.moreInfo.links=e[3]},e=>{c.moreInfo.links=[]}).then(()=>{t((n=e.name,l=e.location,`https://api.flickr.com/services/rest/?method=flickr.photos.search&format=json&api_key=d4cd83c196005f3d68c38be13ea02cd2&per_page=20&nojsoncallback=1&lat=${l.lat}&lon=${l.lng}&tags=${n} `)).then(e=>{c.moreInfo.photosUrl=(e=>{const a=[];return e.photos.photo.forEach(e=>{a.push("http://farm"+e.farm+".static.flickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_t.jpg")}),a})(e)},e=>{c.moreInfo.photosUrl=[]}).then(()=>i(c.moreInfo))})});var n,l}}}();const ViewModel=function(){const e=this,a=a=>{a.number=e.myPlaces().length+1,a.visibility=ko.observable(!0),e.myPlaces.push(a)};var n;e.myPlaces=ko.observableArray([]),places.MY_PLACES.forEach(e=>{a(e)}),e.visibleMenu=ko.observable(!1),e.openPlace=ko.observable(),e.infoContainer=ko.observable(!0),e.inputText=ko.observable(""),e.inputNewPlaceVisible=ko.observable(!1),e.inputNewPlaceValue=ko.observable(""),e.init=(()=>{const a=mapView.init();placesService.init(a),e.myPlaces().forEach(e=>{e.marker=mapView.createMarkerMap(e)})}),e.mapErrHandler=(()=>{window.alert("Sorry!! We are having problems with Google Maps API, please try later")}),e.toggleMenuHandler=(()=>{e.visibleMenu(!e.visibleMenu())}),e.filterPlacesHandler=(()=>{mapView.closeInfoWindow(),e.infoContainer(!0);for(let a=0;a<e.myPlaces().length;a++){let n=e.myPlaces()[a],l=e.inputText().toLocaleLowerCase();n.name.substr(0,l.length).toLocaleLowerCase().includes(l)?(n.visibility(!0),n.marker.setVisible(!0)):(n.visibility(!1),n.marker.setVisible(!1))}}),e.removePlaceHandler=(a=>{confirm(`Do you want delete ${a.name}`)&&(a.marker.setMap(null),e.myPlaces.remove(e=>e.placeId===a.placeId),e.openPlace()&&e.openPlace().placeId===a.placeId&&e.resetOpenPlaceHandler(),(a=>{for(let n=a-1;n<e.myPlaces().length;n++){let a=e.myPlaces()[n];a.number--,a.marker.set("label",a.number.toString())}})(a.number))}),e.placeClickHandler=(a=>{e.showPlaceDetail(a.marker),mapView.animateMarker(a.marker),placesService.getMoreInfo(a).then(a=>{a.links.length||a.photosUrl.length||(a.name+=" :Sorry!! No further information found :("),e.openPlace(a),e.infoContainer(!1),e.visibleMenu(!0)})}),e.toggleInputHandler=(()=>{e.inputNewPlaceVisible(!e.inputNewPlaceVisible())}),e.searchValueHandler=(()=>{e.inputNewPlaceValue()&&placesService.searchText(e.inputNewPlaceValue()).then(a=>{e.createPlace(a)},e=>{window.alert("Please write the place again")})}),e.resetOpenPlaceHandler=(()=>{e.infoContainer(!0),e.toggleMenuHandler(),window.setTimeout(()=>{e.openPlace(void 0)},1e3)}),e.createPlace=(l=>{n="",e.inputNewPlaceValue(n);const o={name:l.name,placeId:l.place_id,location:{lat:l.geometry.location.lat(),lng:l.geometry.location.lng()}};a(o),o.marker=mapView.createMarkerMap(o)}),e.showPlaceDetail=(e=>{placesService.searchDetail(e.placeId).then(a=>{mapView.openInfoWindowWithPlaceDetails(e,a)})})};placesViewModel=new ViewModel,ko.applyBindings(placesViewModel);